<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de {{ employee.real_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    .week-selector {
        margin-bottom: 1.5rem;
        text-align: right;
    }
    
    .week-form {
        display: inline-flex;
        align-items: center;
        background-color: var(--table-row-bg);
        padding: 0.5rem 1rem;
        border-radius: var(--radius);
    }
    
    .week-form label {
        margin-right: 0.5rem;
        color: var(--text-light);
    }
    
    .week-form select {
        background-color: var(--bg-color);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        padding: 0.25rem 0.5rem;
        border-radius: var(--radius);
    }
    
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: var(--text-light);
        font-size: 0.9rem;
    }
    
    .progress-container {
        margin: 1rem 0;
    }
    
    .chart-container {
        position: relative;
        height: 250px;
        margin-top: 1rem;
    }
    
    .tabs {
        display: flex;
        flex-wrap: wrap;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 1.5rem;
    }
    
    .tab {
        padding: 0.75rem 1rem;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        font-size: 0.95rem;
        text-align: center;
        flex: 1;
    }
    
    .tab.active {
        border-bottom: 3px solid var(--primary-color);
        color: var(--primary-color);
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
    
    .trend-indicator {
        display: inline-flex;
        align-items: center;
        margin-left: 0.5rem;
        font-size: 0.9rem;
    }
    
    .trend-up {
        color: var(--success-color);
    }
    
    .trend-down {
        color: var(--danger-color);
    }
    
    .trend-neutral {
        color: var(--warning-color);
    }
    
    /* Ajustes para mobile */
    @media (max-width: 768px) {
        .tab {
            padding: 0.6rem 0.5rem;
            font-size: 0.85rem;
        }
        
        .dashboard-container {
            grid-template-columns: 1fr;
        }
    }
    </style>
</head>
<body>
    <div class="container">
    <a href="{{ url_for('auth.index') }}" class="back-button">Voltar</a>
    
    <h1>Dashboard de {{ employee.real_name }}</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="{{ category }}-message">{{ message }}</div>
    {% endfor %}
    {% endif %}
    {% endwith %}
    
    <!-- Dashboard Cards -->
    <div class="week-selector">
    <form method="GET" action="{{ url_for('dashboard.employee_dashboard_enhanced') }}" class="week-form">
    <label for="week">Semana:</label>
    <select id="week" name="week" onchange="this.form.submit()">
    <option value="1" {% if selected_week == '1' %}selected{% endif %}>Semana 1</option>
    <option value="2" {% if selected_week == '2' %}selected{% endif %}>Semana 2</option>
    <option value="3" {% if selected_week == '3' %}selected{% endif %}>Semana 3</option>
    <option value="4" {% if selected_week == '4' %}selected{% endif %}>Semana 4</option>
    <option value="5" {% if selected_week == '5' %}selected{% endif %}>Semana 5</option>
    </select>
    </form>
    </div>
    <div class="dashboard-container">
    <!-- Pontos Diários -->
    <div class="dashboard-card">
    <h3>Pontos Hoje</h3>
    <div class="stat-value">{{ daily_points }}</div>
    <div class="stat-label">Meta diária: {{ employee.daily_goal }} pontos</div>
    <div class="progress-container">
    <div class="progress-bar-container">
    <div class="progress-bar progress-{{ 'green' if daily_percentage >= 100 else 'orange' if daily_percentage >= 50 else 'red' }}" 
    style="width: {{ daily_percentage }}%">
    </div>
    </div>
    <div class="progress-percentage">
    {{ daily_percentage|round(1) }}% da meta diária
    </div>
    </div>
    </div>
    
    <!-- Pontos Semanais -->
    <div class="dashboard-card">
    <h3>Pontos Semana {{ selected_week }}</h3>
    <div class="stat-value">{{ weekly_points }}</div>
    <div class="stat-label">Meta semanal: {{ employee.weekly_goal }} pontos</div>
    <div class="progress-container">
    <div class="progress-bar-container">
    <div class="progress-bar progress-{{ 'green' if weekly_percentage >= 100 else 'orange' if weekly_percentage >= 50 else 'red' }}" 
    style="width: {{ weekly_percentage }}%">
    </div>
    </div>
    <div class="progress-percentage">
    {{ weekly_percentage|round(1) }}% da meta semanal
    </div>
    </div>
    </div>
    
    <!-- Pontos Mensais -->
    <div class="dashboard-card">
    <h3>Pontos Mensais</h3>
    <div class="stat-value">{{ monthly_points }}</div>
    <div class="stat-label">Meta mensal: {{ employee.monthly_goal }} pontos</div>
    <div class="progress-container">
    <div class="progress-bar-container">
    <div class="progress-bar progress-{{ 'green' if monthly_percentage >= 100 else 'orange' if monthly_percentage >= 50 else 'red' }}" 
    style="width: {{ monthly_percentage }}%">
    </div>
    </div>
    <div class="progress-percentage">
    {{ monthly_percentage|round(1) }}% da meta mensal
    </div>
    </div>
    </div>
    </div>
    
    <!-- Tabs para diferentes visualizações -->
    <div class="tabs">
    <div class="tab" data-tab="evolution">Evolução Mensal</div>
    <div class="tab" data-tab="weekly">Desempenho Semanal</div>
    <div class="tab active" data-tab="register">Registrar Pontos</div>
    <div class="tab" data-tab="history">Histórico</div>
    </div>
    
    <!-- Conteúdo das Tabs -->
    <div id="evolution" class="tab-content">
    <h2>Evolução Mensal</h2>
    <div class="chart-container">
    <canvas id="monthlyChart"></canvas>
    </div>
    </div>
    
    <div id="weekly" class="tab-content">
    <h2>Desempenho Semanal</h2>
    <div class="chart-container">
    <canvas id="weeklyChart"></canvas>
    </div>
    </div>
    
    <div id="register" class="tab-content active">
    <h2>Novo Registro</h2>
    <form method="POST">
    <label for="refinery">Refinaria:</label>
    <select id="refinery" name="refinery" required>
    <option value="{{ employee.default_refinery }}" selected>{{ employee.default_refinery }}</option>
    <option value="UTE-CBT">UTE-CBT</option>
    <option value="UTE-NPI">UTE-NPI</option>
    <option value="UTGCA">UTGCA</option>
    <option value="RPBC">RPBC</option>
    <option value="REVAP">REVAP</option>
    <option value="REPLAN">REPLAN</option>
    <option value="RECAP">RECAP</option>
    </select>
    
    <label for="points">Pontos:</label>
    <input type="number" id="points" name="points" required min="0">
    
    <label for="observations">Observações:</label>
    <textarea id="observations" name="observations" required></textarea>
    
    <button type="submit" class="btn">Registrar</button>
    </form>
    </div>
    
    <div id="history" class="tab-content">
    <h2>Seus Registros</h2>
    {% if entries %}
    <table>
    <thead>
    <tr>
    <th>Data</th>
    <th>Refinaria</th>
    <th>Pontos</th>
    <th>Observações</th>
    </tr>
    </thead>
    <tbody>
    {% for entry in entries %}
    <tr>
    <td>{{ entry.date }}</td>
    <td>{{ entry.refinery }}</td>
    <td>{{ entry.points }}</td>
    <td>{{ entry.observations }}</td>
    </tr>
    {% endfor %}
    </tbody>
    </table>
    {% else %}
    <p>Nenhum registro encontrado.</p>
    {% endif %}
    </div>
    </div>
    
    <!-- Carregando o JavaScript externo -->
    <script src="{{ url_for('static', filename='employee_dashboard.js') }}"></script>
    <script>
    // Dados para os gráficos
    var monthlyData = JSON.parse('{{ monthly_data|tojson|safe }}');
    var weeklyData = JSON.parse('{{ weekly_data|tojson|safe }}');
    
    // Inicializar quando o documento estiver pronto
    document.addEventListener('DOMContentLoaded', function() {
        initEmployeeDashboard(monthlyData, weeklyData);
    });
    </script>
</body>
</html>